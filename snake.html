<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>贪吃蛇 | dericksun22jason</title>
    <style>
        body { 
            margin: 0; padding: 10px; 
            font-family: -apple-system, 'PingFang SC', sans-serif; 
            text-align: center; background: #0f0f0f; color: #fff;
            min-height: 100vh; display: flex; flex-direction: column;
        }
        h1 { margin: 20px 0 10px; }
        p { margin: 10px 0 20px; color: #ccc; }
        #canvas { 
            background: #000; 
            border: 5px solid #4361ee; 
            border-radius: 20px; 
            box-shadow: 0 0 30px rgba(67,97,238,0.6);
            flex: 1; max-width: 100%; max-height: 70vh;
        }
        .controls { margin: 20px 0; }
        #score { font-size: 1.5rem; font-weight: bold; color: #4361ee; }
        button { 
            padding: 15px 40px; font-size: 1.3rem; background: #4361ee; 
            color: white; border: none; border-radius: 15px; 
            cursor: pointer; margin-top: 10px;
        }
        button:active { background: #3a0ca3; }
    </style>
</head>
<body>
    <h1>贪吃蛇小游戏</h1>
    <p>手机：手指在屏幕上滑动控制方向<br>电脑：方向键 ↑←↓→ 控制</p>
    <canvas id="canvas"></canvas>
    <div class="controls">
        <div>当前得分: <span id="score">0</span></div>
        <button onclick="restart()">重新开始</button>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const grid = 20; // 每个格子大小
        let count = 0;

        let snake = [{x: 10, y: 10}];
        let food = {x: 15, y: 15};
        let dx = 0;
        let dy = 0;
        let score = 0;
        let gameLoop;

        // 自适应画布大小
        function resize() {
            const size = Math.min(window.innerWidth - 20, window.innerHeight * 0.6, 500);
            canvas.width = size - (size % grid);
            canvas.height = canvas.width;
        }
        resize();
        window.addEventListener('resize', resize);

        function randomFood() {
            food.x = Math.floor(Math.random() * (canvas.width / grid));
            food.y = Math.floor(Math.random() * (canvas.height / grid));
            // 避免食物生成在蛇身上
            if (snake.some(s => s.x === food.x && s.y === food.y)) randomFood();
        }

        function draw() {
            // 清屏
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 画食物（红苹果）
            ctx.fillStyle = '#ff3333';
            ctx.beginPath();
            ctx.arc(food.x * grid + grid/2, food.y * grid + grid/2, grid/2 - 2, 0, Math.PI * 2);
            ctx.fill();

            // 画蛇
            snake.forEach((part, i) => {
                ctx.fillStyle = i === 0 ? '#33ff33' : '#99ff99';
                ctx.fillRect(part.x * grid + 2, part.y * grid + 2, grid - 4, grid - 4);
            });

            // 游戏结束覆盖层
            if (dx === 0 && dy === 0 && count > 0) { // 只有玩过一次才显示结束
                ctx.fillStyle = 'rgba(0,0,0,0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 40px sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('游戏结束', canvas.width/2, canvas.height/2 - 40);
                ctx.font = '28px sans-serif';
                ctx.fillText('得分: ' + score, canvas.width/2, canvas.height/2 + 10);
            }
        }

        function update() {
            if (dx === 0 && dy === 0) return; // 还没开始

            count++;
            const head = {x: snake[0].x + dx, y: snake[0].y + dy};

            // 撞墙
            if (head.x < 0 || head.x >= canvas.width/grid || head.y < 0 || head.y >= canvas.height/grid) {
                dx = dy = 0;
                draw();
                return;
            }

            // 撞自己
            if (snake.some(part => part.x === head.x && part.y === head.y)) {
                dx = dy = 0;
                draw();
                return;
            }

            snake.unshift(head);

            // 吃到食物
            if (head.x === food.x && head.y === food.y) {
                score++;
                document.getElementById('score').textContent = score;
                randomFood();
            } else {
                snake.pop();
            }

            draw();
        }

        function restart() {
            snake = [{x: 10, y: 10}];
            randomFood();
            dx = 0; dy = 0;
            score = 0;
            count = 0;
            document.getElementById('score').textContent = 0;
            draw();
            clearInterval(gameLoop);
            gameLoop = setInterval(update, 150);
        }

        // 键盘控制
        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowUp' && dy !== 1) { dx = 0; dy = -1; }
            if (e.key === 'ArrowDown' && dy !== -1) { dx = 0; dy = 1; }
            if (e.key === 'ArrowLeft' && dx !== 1) { dx = -1; dy = 0; }
            if (e.key === 'ArrowRight' && dx !== -1) { dx = 1; dy = 0; }
        });

        // 手机滑动控制（超灵敏）
        let touchstartX = 0, touchstartY = 0;
        canvas.addEventListener('touchstart', e => {
            touchstartX = e.changedTouches[0].screenX;
            touchstartY = e.changedTouches[0].screenY;
            e.preventDefault();
        }, {passive: false});

        canvas.addEventListener('touchend', e => {
            if (!touchstartX || !touchstartY) return;
            let diffX = e.changedTouches[0].screenX - touchstartX;
            let diffY = e.changedTouches[0].screenY - touchstartY;

            if (Math.max(Math.abs(diffX), Math.abs(diffY)) > 30) {
                if (Math.abs(diffX) > Math.abs(diffY)) {
                    if (diffX > 0 && dx !== -1) { dx = 1; dy = 0; } // 右
                    else if (diffX < 0 && dx !== 1) { dx = -1; dy = 0; } // 左
                } else {
                    if (diffY > 0 && dy !== -1) { dx = 0; dy = 1; } // 下
                    else if (diffY < 0 && dy !== 1) { dx = 0; dy = -1; } // 上
                }
            }
            touchstartX = touchstartY = 0;
        });

        // 页面加载完自动开始
        window.onload = () => {
            draw();
            gameLoop = setInterval(update, 150);
        };
    </script>
</body>
</html>
